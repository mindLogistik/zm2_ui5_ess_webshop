sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/core/UIComponent","sap/ui/core/routing/History","../model/cart"],function(e,t,r,n,s){"use strict";return e.extend("diehlwebshop.controller.BaseController",{cart:s,getRouter:function(){return r.getRouterFor(this)},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onAvatarPress:function(){var e=this.getResourceBundle().getText("avatarButtonMessageToastText");t.show(e)},onStateChange:function(e){var t=e.getParameter("layout");var r=e.getParameter("maxColumnsCount");this.getModel("appView").setProperty("/smallScreenMode",r===1);if(r>1&&t==="OneColumn"){this._setLayout("Two")}},_setLayout:function(e){if(e){this.getModel("appView").setProperty("/layout",e+"Column"+(e==="One"?"":"sMidExpanded"))}},onBack:function(){var e=n.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getRouter().navTo("home")}},_addToCart:function(e,t){if(!e){return}const r=this.getResourceBundle();const n=this.getModel("cartProducts");if(!n){jQuery.sap.log.error("cartProducts Model nicht gefunden.");return}const s=Math.max(1,parseInt(t,10)||1);let o=n.getProperty("/cartEntries");if(!Array.isArray(o)){o=Object.values(o||{})}const a=String(e.ZmmWebsArtikelId||e.ProductId||e.Produktid||"").trim();if(!a){jQuery.sap.log.error("Kein Produkt-SchlÃ¼ssel gefunden (z. B. ZmmWebsArtikelId).");return}const i=String(e.ZmmWebsKatId||e.Category||"").trim();const c=String(e.ZmmWebsArtBez||e.BESCHREIBUNG||e.ZmmWebsKatBez||e.ZmmWebsKatId||a).trim();const d=String(e.ZmmWebsDocId||e.DocId||e.ZmmWebsDocID||"").trim();const u=(e.Wlief||"").trim();const l=(e.Matkl||"").trim();const g=String(e.Meins||"ST").trim();const m=String(e.Waers||e.Currency||"EUR").trim();const p=Number(e.Bapre??0);const f=String(e.receiver||"").trim();const h=typeof e.weExpectedIndex==="number"?e.weExpectedIndex:-1;const C=String(e.Idnlf||"").trim().slice(0,35);const I=String(e.addText||e.ddText||e.AddText||e.Zusatztext||e.zusatztext||e.freitextAddText||"").trim();const x=o.findIndex(e=>String(e.ZmmWebsArtikelId||e.ProductId||e.Produktid)===a);if(x>-1){const e=parseInt(o[x].MENGE,10)||0;const t=e+s;o[x].MENGE=t;o[x].Quantity=t;if(!o[x].ZmmWebsKatId&&i){o[x].ZmmWebsKatId=i}if(!o[x].ZmmWebsArtBez&&c){o[x].ZmmWebsArtBez=c}if(!o[x].ZmmWebsDocId&&d){o[x].ZmmWebsDocId=d}if(!o[x].Meins&&g){o[x].Meins=g}if(!o[x].Waers&&m){o[x].Waers=m}if(o[x].Bapre==null||o[x].Bapre===""){o[x].Bapre=p}if(!o[x].Wlief&&u){o[x].Wlief=u}if(!o[x].Matkl&&l){o[x].Matkl=l}if(!o[x].receiver&&f){o[x].receiver=f}if(!Number.isInteger(o[x].weExpectedIndex)){o[x].weExpectedIndex=h}if(!o[x].Idnlf&&C){o[x].Idnlf=C}if(!String(o[x].addText||"").trim()&&I){o[x].addText=I}if(!String(o[x].AddText||"").trim()&&I){o[x].AddText=I}}else{o.push({ZmmWebsArtikelId:a,ZmmWebsKatId:i,ZmmWebsKatBez:String(e.ZmmWebsKatBez||c||"").trim(),ZmmWebsArtBez:c,ZmmWebsDocId:d,MENGE:s,Quantity:s,Meins:g,Waers:m,Bapre:p,Wlief:u,Matkl:l,receiver:f,weExpectedIndex:h,Idnlf:C,addText:I,AddText:I,accountType:e.accountType||"",costCenter:e.costCenter||"",internalOrder:e.internalOrder||"",accountValue:e.accountValue||"",glAccount:e.glAccount||"",STATUS:e.STATUS||"A"})}n.setProperty("/cartEntries",o);n.refresh(true);sap.m.MessageToast.show(r.getText("productAddedToCart"))},toggleCart:function(){var e=sap.ui.core.routing.HashChanger.getInstance();var t=e.getHash()||"";console.log("[toggleCart] hash vorher:",t);var r=t==="cart"||t.endsWith("/cart");console.log("[toggleCart] bIsCartHash:",r);if(r){console.log("[toggleCart] -> close");this._closeCart()}else{console.log("[toggleCart] -> open");this._openCart()}},_openCart:function(){var e=this.getOwnerComponent().getModel("appView");if(!e){return}var t=sap.ui.core.routing.HashChanger.getInstance();var r=t.getHash()||"";if(r==="cart"||r.endsWith("/cart")){e.setProperty("/cartOpen",true);return}e.setProperty("/lastNonCartHash",r);e.setProperty("/cartOpen",true);if(r){t.replaceHash(r+"/cart")}else{t.replaceHash("cart")}},_closeCart:function(){var e=this.getOwnerComponent().getModel("appView");if(!e){return}var t=sap.ui.core.routing.HashChanger.getInstance();var r=t.getHash()||"";var n="";if(r.endsWith("/cart")){n=r.slice(0,-5)}if(!n&&r==="cart"){n=e.getProperty("/lastNonCartHash")||""}if(!n){n=e.getProperty("/lastNonCartHash")||""}if(n==="purchaseRequests"||n==="purchaseRequestsCart"){e.setProperty("/skipNextPurchaseRequestsRebind",true)}e.setProperty("/cartOpen",false);if(n){t.replaceHash(n)}else{this.getOwnerComponent().getRouter().navTo("categories",{},true)}},_clearComparison:function(){var e=this.getOwnerComponent().getModel("comparison");e.setData({category:"",item1:"",item2:""})}})});
//# sourceMappingURL=BaseController.js.map