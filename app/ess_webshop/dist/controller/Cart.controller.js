sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/Device","../model/formatter","sap/m/MessageBox","sap/m/MessageToast"],(t,e,r,o,s,n)=>{"use strict";var i="cartProducts";var a="savedForLaterEntries";var c="cartEntries";return t.extend("diehlwebshop.controller.Cart",{formatter:o,onInit:function(){this.getView().setModel(this.getOwnerComponent().getModel());this._oRouter=this.getRouter();this._oRouter.getRoute("cart").attachPatternMatched(this._routePatternMatched,this);this._oRouter.getRoute("productCart").attachPatternMatched(this._routePatternMatched,this);var t=new e({});this.getView().setModel(t,"cfg");this._toggleCfgModel();var r=this.byId("editButton");r.addEventDelegate({onAfterRendering:function(){r.focus()}})},onExit:function(){if(this._orderDialog){this._orderDialog.destroy()}if(this._orderBusyDialog){this._orderBusyDialog.destroy()}},onQuantityLiveChange:function(t){const e=t.getSource();const r=e.getValue();const o=Math.max(1,parseInt(r,10)||1);if(parseInt(r,10)!==o){e.setValue(o)}const s=e.getBindingContext("cartProducts");if(!s){return}const n=s.getModel();const i=s.getPath();n.setProperty(i+"/MENGE",o)},_routePatternMatched:function(){const t=this.getModel("appView");const e=t.getProperty("/layout");const r=!e.startsWith("TwoColumns");if(r){this._setLayout("Three")}const o=this.getModel(i);const s=o.getProperty("/"+c);if(Array.isArray(s)&&s.length>0){o.setProperty("/showProceedButton",true);o.setProperty("/showEditButton",true)}this.byId("entryList").removeSelections()},onEditOrDoneButtonPress:function(){this._toggleCfgModel()},_toggleCfgModel:function(){var t=this.getView().getModel("cfg");var e=t.getData();var o=this.getResourceBundle();var s=!e.hasOwnProperty("inDelete");var n=s?true:e.inDelete;var i=r.system.phone?"None":"SingleSelectMaster";var a=r.system.phone?"Active":"Inactive";t.setData({inDelete:!n,notInDelete:n,listMode:n?i:"Delete",listItemType:n?a:"Inactive",pageTitle:n?o.getText("Cart_rootLabel"):o.getText("cartTitleEdit")})},onEntryListPress:function(t){this._showProduct(t.getSource())},onEntryListSelect:function(t){this._showProduct(t.getParameter("listItem"))},onSaveForLater:function(t){var e=t.getSource().getBindingContext(i);this._changeList(a,c,e)},onAddBackToBasket:function(t){var e=t.getSource().getBindingContext(i);this._addToCartKeepSaved(e)},_changeList:function(t,e,r){var o=r.getModel();var s=r.getObject();var n=o.getProperty("/"+t)||[];var i=o.getProperty("/"+e)||[];if(!Array.isArray(n)){n=Object.values(n||{})}if(!Array.isArray(i)){i=Object.values(i||{})}var a=String(s.ZmmWebsArtikelId||"");var c=parseInt(s.MENGE,10)||1;var g=n.findIndex(t=>String(t.ZmmWebsArtikelId)===a);if(g===-1){var d=Object.assign({},s);d.MENGE=c;n.push(d)}else{var l=parseInt(n[g].MENGE,10)||0;n[g].MENGE=l+c}var u=i.findIndex(t=>String(t.ZmmWebsArtikelId)===a);if(u>-1){i.splice(u,1)}o.setProperty("/"+t,n);o.setProperty("/"+e,i);o.refresh(true)},_addToCartKeepSaved:function(t){var e=t.getModel();var r=t.getObject();var o=e.getProperty("/"+c)||[];if(!Array.isArray(o)){o=Object.values(o||{})}var s=String(r.ZmmWebsArtikelId||"");var n=o.findIndex(t=>String(t.ZmmWebsArtikelId)===s);var i=parseInt(r.MENGE,10)||1;if(n===-1){var a=Object.assign({},r);o.push(a)}else{o[n].MENGE=(parseInt(o[n].MENGE,10)||0)+i}e.setProperty("/"+c,o);e.setProperty("/showProceedButton",o.length>0);e.setProperty("/showEditButton",o.length>0);e.refresh(true)},_showProduct:function(t){var e=t.getBindingContext(i).getObject();var o=false;if(!r.system.phone){o=this.getModel("appView").getProperty("/layout").startsWith("Three")}else{o=false;this._setLayout("Two")}this._oRouter.navTo(o?"productCart":"product",{id:e.ZmmWebsKatId,productId:e.ZmmWebsArtikelId},!r.system.phone)},onCartEntriesDelete:function(t){this._deleteProduct(c,t)},onSaveForLaterDelete:function(t){this._deleteProduct(a,t)},_deleteProduct:function(t,e){const r=e.getParameter("listItem");const o=r.getBindingContext(i);const a=this.getResourceBundle();const c=o.getProperty("ZmmWebsArtikelId");const g=o.getProperty("ZmmWebsArtBez");const d=o.getModel();s.show(a.getText("cartDeleteDialogMsg"),{title:a.getText("cartDeleteDialogTitle"),actions:[s.Action.DELETE,s.Action.CANCEL],onClose:function(e){if(e!==s.Action.DELETE)return;const r=d.getProperty("/"+t)||[];let o=Array.isArray(r)?r.slice():Object.values(r);const i=o.findIndex(t=>String(t.ZmmWebsArtikelId)===String(c));if(i>-1){o.splice(i,1);d.setProperty("/"+t,o);d.refresh(true);const e=o.length>0;d.setProperty("/showProceedButton",e);d.setProperty("/showEditButton",e);const r=t==="cartEntries"?this.byId("entryList"):this.byId("saveForLaterList");if(r){r.removeSelections()}n.show(a.getText("cartDeleteDialogConfirmDeleteMsg",[g]))}else{n.show(a.getText("cartNoData"))}}.bind(this)})},onProceedButtonPress:function(){const t=this.getOwnerComponent().getModel("cartProducts");const e=t.getProperty("/cartEntries");const r=Array.isArray(e)?e:Object.values(e||{});if(r.length===0){sap.m.MessageToast.show(this.getResourceBundle().getText("cartEmptyToast"));return}const o=this.getOwnerComponent().getModel("appView");if(o){o.setProperty("/layout","MidColumnFullScreen");o.setProperty("/cartOpen",false)}this.getRouter().navTo("checkoutWizard")}})});
//# sourceMappingURL=Cart.controller.js.map