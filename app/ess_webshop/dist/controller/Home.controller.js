sap.ui.define(["./BaseController","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment","sap/m/SelectDialog","sap/m/StandardListItem"],(e,t,r,i,s,n,o,a)=>{"use strict";return e.extend("diehlwebshop.controller.Home",{formatter:t,onInit:function(){const e=this.getOwnerComponent();this._router=e.getRouter();this._router.getRoute("categories").attachMatched(this._onRouteMatched,this);this.getView().setModel(new sap.ui.model.json.JSONModel({items:[]}),"freitext");const t=e.getModel("appView");if(t&&t.getProperty("/cartOpen")==null){t.setProperty("/cartOpen",false)}this._router.attachRouteMatched(function(e){const t=e.getParameter("name");const r=this.getOwnerComponent().getModel("appView");if(!r){return}const i=r.getProperty("/_lastRouteName")||"";const s=t==="cart"||t==="productCart"||t==="purchaseRequestsCart";if(!s){r.setProperty("/lastNonCartRouteName",t);r.setProperty("/lastNonCartRouteArgs",e.getParameter("arguments")||{})}r.setProperty("/_lastRouteName",t);const n=t==="purchaseRequests"||t==="purchaseRequestsCart";const o=i==="product"||i==="category"||i==="checkoutWizard";if(n&&o&&typeof this._resetCategoriesToRoot==="function"){this._resetCategoriesToRoot()}if(i==="cart"&&n){r.setProperty("/skipNextPurchaseRequestsRebind",true)}if(t==="checkoutWizard"){r.setProperty("/layout","MidColumnFullScreen");r.setProperty("/cartOpen",false);return}if(s){r.setProperty("/layout","ThreeColumnsMidExpanded");r.setProperty("/cartOpen",true)}else{r.setProperty("/layout","TwoColumnsMidExpanded");r.setProperty("/cartOpen",false)}},this);const r=new sap.ui.model.json.JSONModel({currentParentId:"",pathStack:[],breadcrumbText:""});this.getView().setModel(r,"catnav");this._autoOpenPurchaseRequestsIfAny();const i=sap.ui.core.routing.HashChanger.getInstance().getHash()||"";if(!i||i==="categories"){this._router.navTo("purchaseRequestsCart",{},true)}const s=e.getModel();s.metadataLoaded().then(function(){setTimeout(function(){this._refreshCategoryList();this._loadOciCatalogs()}.bind(this),0)}.bind(this))},_autoOpenPurchaseRequestsIfAny:function(){const e=this.getOwnerComponent().getModel();e.metadataLoaded().then(function(){}.bind(this))},_loadOciCatalogs:function(){const e=this.getOwnerComponent().getModel("ociCatalogs");const t=this.getOwnerComponent().getModel();if(!e||!t){return}t.read("/KatalogSet",{success:function(t){const r=t&&t.results?t.results:[];const i=r.find(e=>String(e.ZmmWebsKatBez||"").toLowerCase()==="kataloge");if(!i){e.setData([{type:"FREETEXT",katalogName:this.getResourceBundle().getText("freitextOpenDialogButtonText")}]);return}const s=String(i.ZmmWebsKatId||"");const n=r.filter(e=>String(e.ZmmWebsKatParentId||"")===s).map(e=>({katalogName:String(e.ZmmWebsKatBez||""),serviceId:String(e.WsiDescriptionText||"").trim()}));const o=[{type:"FREETEXT",katalogName:this.getResourceBundle().getText("freitextOpenDialogButtonText")},...n];e.setData(o)}.bind(this),error:function(){e.setData([{type:"FREETEXT",katalogName:this.getResourceBundle().getText("freitextOpenDialogButtonText")}])}.bind(this)})},onPurchaseRequestPress:function(e){var t=e.getSource();var r=t.getBindingContext("purchaseRequest");var i=r.getProperty("Banfn");sap.m.MessageToast.show(this.getModel("i18n").getResourceBundle().getText("purchaseRequestDetailMessage",[i]))},_resetCategoriesToRoot:function(){const e=this.getView().getModel("catnav");if(!e){return}e.setProperty("/currentParentId","");e.setProperty("/pathStack",[]);e.setProperty("/breadcrumbText","");const t=this.byId("searchField");if(t&&t.setValue){t.setValue("")}const r=this.byId("productHomeList");const i=this.byId("categoryHomeList");if(r&&r.setVisible){r.setVisible(false)}if(i&&i.setVisible){i.setVisible(true)}this._refreshCategoryList()},_refreshCategoryList:function(){const e=this.byId("categoryHomeList");const t=e&&e.getBinding("items");if(!t)return;const r=this.getView().getModel("catnav").getProperty("/currentParentId")||"";let i;if(r===""){i=new sap.ui.model.Filter({and:false,filters:[new sap.ui.model.Filter("ZmmWebsKatParentId",sap.ui.model.FilterOperator.EQ,""),new sap.ui.model.Filter("ZmmWebsKatParentId",sap.ui.model.FilterOperator.EQ,null)]})}else{i=new sap.ui.model.Filter("ZmmWebsKatParentId",sap.ui.model.FilterOperator.EQ,r)}t.filter([i],"Application")},_onRouteMatched:function(){var e=this.getModel("appView").getProperty("/smallScreenMode");if(e){this._setLayout("One")}setTimeout(function(){this._refreshCategoryList();var e=this.byId("categoryHomeList");var t=this.getView().getModel("catnav");if(!e||!t){return}if(this._bAutoLevelUpOnce){this._bAutoLevelUpOnce=false;return}e.attachEventOnce("updateFinished",function(){var r=e.getItems()||[];var i=t.getProperty("/pathStack")||[];if(r.length===0&&i.length>0){this._bAutoLevelUpOnce=true;this.onCategoryLevelUp()}},this)}.bind(this),0)},onSearch:function(e){var t=(e.getSource().getValue()||"").toLowerCase();var r=this.byId("categoryHomeList");if(!r){return}r.getItems().forEach(function(e){var r=(typeof e.getTitle==="function"?e.getTitle():"")||e.getBindingContext()&&e.getBindingContext().getProperty("ZmmWebsKatBez")||"";var i=!t||r.toLowerCase().indexOf(t)>-1;e.setVisible(i)})},onExtMatnrLiveChange:function(e){const t=e.getSource();const r=this.getResourceBundle();const i=t.getValue()||"";if(i.length>35){t.setValueState("Error");t.setValueStateText(r.getText("freitext.err.extMatnrTooLong",[35]))}else{t.setValueState("None");t.setValueStateText("")}},onValueHelpCurrency:function(e){var t=this.getView();var r=this.getOwnerComponent().getModel();var i=e.getSource();this._oCurrActiveInput=i;if(!this._oCurrJsonModel){this._oCurrJsonModel=new sap.ui.model.json.JSONModel({results:[]});t.setModel(this._oCurrJsonModel,"vhCurr")}var s=function(){if(!this._oCurrVH){this._oCurrVH=new sap.m.SelectDialog({title:this.getResourceBundle().getText("home.vh.currency.title"),items:{path:"vhCurr>/results",template:new sap.m.StandardListItem({title:"{vhCurr>Waers}"})},search:function(e){var t=(e.getParameter("value")||"").trim().toLowerCase();this._applyCurrencySearchFilter(t)}.bind(this),confirm:function(e){var t=e.getParameter("selectedItem");if(!t){return}var r=t.getBindingContext("vhCurr").getObject();var i=String(r.Waers||"").trim();if(this._oCurrActiveInput){this._oCurrActiveInput.setValue(i)}}.bind(this),cancel:function(){}});t.addDependent(this._oCurrVH)}var e=(i.getValue()||"").trim();this._oCurrVH.open(e);this._applyCurrencySearchFilter(e)}.bind(this);var n=this._oCurrJsonModel.getProperty("/results")||[];if(n.length>0){s();return}r.read("/IsoCurcSet",{urlParameters:{$select:"Waers",$top:"5000"},success:function(e){var t=e&&e.results?e.results:[];t=t.map(function(e){var t=Object.assign({},e);t.__waers=String(t.Waers||"").toLowerCase();return t});this._oCurrJsonModel.setProperty("/results",t);s()}.bind(this),error:function(e){sap.m.MessageToast.show(this.getResourceBundle().getText("home.vh.currency.loadError"));console.log(e)}})},_applyCurrencySearchFilter:function(e){if(!this._oCurrVH){return}var t=String(e||"").trim().toLowerCase();var r=this._oCurrVH.getBinding("items");if(!r){return}if(!t){r.filter([]);return}r.filter([new sap.ui.model.Filter("__waers",sap.ui.model.FilterOperator.Contains,t)],"Application")},onValueHelpEkgrp:function(e){var t=this.getView();var r=this.getOwnerComponent().getModel();var i=e.getSource();this._oEkgrpActiveInput=i;if(!this._oEkgrpJsonModel){this._oEkgrpJsonModel=new sap.ui.model.json.JSONModel({results:[]});t.setModel(this._oEkgrpJsonModel,"vhEkgrp")}var s=function(){if(!this._oEkgrpVH){this._oEkgrpVH=new sap.m.SelectDialog({title:this.getResourceBundle().getText("home.vh.ekgrp.title"),items:{path:"vhEkgrp>/results",template:new sap.m.StandardListItem({title:"{vhEkgrp>Ekgrp}",description:"{vhEkgrp>Eknam}"})},search:function(e){var t=(e.getParameter("value")||"").trim();var r=e.getSource().getBinding("items");if(!r){return}if(!t){r.filter([]);return}r.filter([new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Ekgrp",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("Eknam",sap.ui.model.FilterOperator.Contains,t)],and:false})])}.bind(this),confirm:function(e){var t=e.getParameter("selectedItem");if(!t){return}var r=t.getBindingContext("vhEkgrp").getObject();var i=String(r.Ekgrp||"").trim();if(this._oEkgrpActiveInput){this._oEkgrpActiveInput.setValue(i)}}.bind(this),cancel:function(){}});t.addDependent(this._oEkgrpVH)}var e=(i.getValue()||"").trim();var r=this._oEkgrpVH.getBinding("items");if(r){r.filter(e?[new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Ekgrp",sap.ui.model.FilterOperator.Contains,e),new sap.ui.model.Filter("Eknam",sap.ui.model.FilterOperator.Contains,e)],and:false})]:[])}this._oEkgrpVH.open(e)}.bind(this);var n=this._oEkgrpJsonModel.getProperty("/results")||[];if(n.length>0){s();return}r.read("/HT024MeSet",{urlParameters:{$select:"Ekgrp,Eknam",$top:"5000"},success:function(e){var t=e&&e.results?e.results:[];this._oEkgrpJsonModel.setProperty("/results",t);s()}.bind(this),error:function(e){sap.m.MessageToast.show(this.getResourceBundle().getText("home.vh.ekgrp.loadError"));console.log(e)}})},onValueHelpUnit:function(e){var t=this.getView();var r=this.getOwnerComponent().getModel();var i=e.getSource();this._oUnitActiveInput=i;if(!this._oUnitJsonModel){this._oUnitJsonModel=new sap.ui.model.json.JSONModel({results:[]});t.setModel(this._oUnitJsonModel,"vhUnit")}var s=function(){if(!this._oUnitVH){this._oUnitVH=new sap.m.SelectDialog({title:this.getResourceBundle().getText("home.vh.unit.title"),items:{path:"vhUnit>/results",template:new sap.m.StandardListItem({title:"{vhUnit>Meins}"})},search:function(e){var t=(e.getParameter("value")||"").trim().toLowerCase();this._applyUnitSearchFilter(t)}.bind(this),confirm:function(e){var t=e.getParameter("selectedItem");if(!t){return}var r=t.getBindingContext("vhUnit").getObject();var i=String(r.Meins||"").trim();if(this._oUnitActiveInput){this._oUnitActiveInput.setValue(i)}}.bind(this),cancel:function(){}});t.addDependent(this._oUnitVH)}var e=(i.getValue()||"").trim();this._oUnitVH.open(e);this._applyUnitSearchFilter(e)}.bind(this);var n=this._oUnitJsonModel.getProperty("/results")||[];if(n.length>0){s();return}r.read("/WrfPohfMeinsSet",{urlParameters:{$select:"Meins",$top:"5000"},success:function(e){var t=e&&e.results?e.results:[];t=t.map(function(e){var t=Object.assign({},e);t.__meins=String(t.Meins||"").toLowerCase();return t});this._oUnitJsonModel.setProperty("/results",t);s()}.bind(this),error:function(e){sap.m.MessageToast.show(this.getResourceBundle().getText("home.vh.unit.loadError"));console.log(e)}})},_applyUnitSearchFilter:function(e){if(!this._oUnitVH){return}var t=String(e||"").trim().toLowerCase();var r=this._oUnitVH.getBinding("items");if(!r){return}if(!t){r.filter([]);return}r.filter([new sap.ui.model.Filter("__meins",sap.ui.model.FilterOperator.Contains,t)],"Application")},onValueHelpUser:function(e){var t=this.getView();var r=this.getOwnerComponent().getModel();var i=e.getSource();this._oUserActiveInput=i;if(!this._oUserJsonModel){this._oUserJsonModel=new sap.ui.model.json.JSONModel({results:[]});t.setModel(this._oUserJsonModel,"vhUser")}var s=function(){if(!this._oUserVH){this._oUserVH=new sap.m.SelectDialog({title:this.getResourceBundle().getText("home.vh.user.title"),items:{path:"vhUser>/results",template:new sap.m.StandardListItem({title:"{vhUser>Bname}"})},search:function(e){var t=(e.getParameter("value")||"").trim().toLowerCase();this._applyUserSearchFilter(t)}.bind(this),confirm:function(e){var t=e.getParameter("selectedItem");if(!t){return}var r=t.getBindingContext("vhUser").getObject();var i=String(r.Bname||"").trim();if(this._oUserActiveInput){this._oUserActiveInput.setValue(i)}}.bind(this),cancel:function(){}});t.addDependent(this._oUserVH)}var e=(i.getValue()||"").trim();this._oUserVH.open(e);this._applyUserSearchFilter(e)}.bind(this);var n=this._oUserJsonModel.getProperty("/results")||[];if(n.length>0){s();return}r.read("/UserAddrSet",{urlParameters:{$select:"Bname",$top:"5000"},success:function(e){var t=e&&e.results?e.results:[];t=t.map(function(e){var t=Object.assign({},e);t.__bname=String(t.Bname||"").toLowerCase();return t});this._oUserJsonModel.setProperty("/results",t);s()}.bind(this),error:function(e){sap.m.MessageToast.show(this.getResourceBundle().getText("home.vh.user.loadError"));console.log(e)}})},_applyUserSearchFilter:function(e){if(!this._oUserVH){return}var t=String(e||"").trim().toLowerCase();var r=this._oUserVH.getBinding("items");if(!r){return}if(!t){r.filter([]);return}r.filter([new sap.ui.model.Filter("__bname",sap.ui.model.FilterOperator.Contains,t)],"Application")},onAddFreitextItem:function(){const e=e=>this.byId(e);const t=this.getResourceBundle();const r=String(e("freitextInputDescription").getValue()||"").trim();const i=String(e("freitextInputRequester").getValue()||"").trim();const s=String(e("freitextInputQuantity").getValue()||"");const n=String(e("freitextInputPrice").getValue()||"");const o=String(e("freitextInputUnit").getValue()||"ST").trim();const a=String(e("freitextInputCurrency").getValue()||"EUR").trim();const u=String(e("freitextInputSupplier").getValue()||"").trim();const l=String(e("freitextInputEkgrp").getValue()||"").trim();const c=String(e("freitextInputExtMatnr").getValue()||"").trim();const p=String(e("freitextInputAddText").getValue()||"").trim();["freitextInputDescription","freitextInputRequester","freitextInputQuantity","freitextInputPrice","freitextInputExtMatnr","freitextInputAddText"].forEach(t=>{const r=e(t);if(r&&r.setValueState){r.setValueState("None");r.setValueStateText("")}});const g=sap.ui.core.format.NumberFormat.getFloatInstance();const d=g.parse(s);const h=g.parse(n);if(c.length>35){const r=e("freitextInputExtMatnr");if(r){r.setValueState("Error");r.setValueStateText(t.getText("freitext.err.extMatnrTooLong",[35]))}sap.m.MessageBox.information(t.getText("freitext.msg.extMatnrTooLong",[35]));return}const m=[];const f=(r,i,s)=>{const n=e(r);if(n){n.setValueState("Error");n.setValueStateText(t.getText(i))}m.push(t.getText(s))};if(!r)f("freitextInputDescription","freitext.err.descRequired","freitext.field.description");if(!i)f("freitextInputRequester","freitext.err.receiverRequired","freitext.field.receiver");if(!(d>0))f("freitextInputQuantity","freitext.err.qtyRequired","freitext.field.quantity");if(!(h>=0))f("freitextInputPrice","freitext.err.priceRequired","freitext.field.price");if(m.length){sap.m.MessageBox.information(t.getText("freitext.msg.missingIntro")+"\n\n• "+m.join("\n• "));return}const v=Math.max(1,parseInt(d,10)||1);const S=Number(isNaN(h)?0:h);const _={ZmmWebsArtikelId:"FREETEXT-"+Date.now(),ZmmWebsKatId:"FREETEXT",ZmmWebsKatBez:r,ZmmWebsArtBez:r,MENGE:v,Meins:o,Bapre:S,Waers:a,receiver:i,Wlief:u,Ekgrp:l,Idnlf:c.slice(0,35),addText:p,AddText:p,weExpectedIndex:-1,accountType:"",accountValue:"",glAccount:"",Matkl:"",STATUS:"A"};this._addToCart(_,v);if(this.onCloseFreitextDialog){this.onCloseFreitextDialog()}},ociCatalogItemFactory:function(e,t){const r=t.getObject();if(r&&r.type==="FREETEXT"){return new sap.m.StandardListItem(this.createId("ociCatalogItem-FREETEXT"),{title:"{i18n>freitextOpenDialogButtonText}",type:"Active",icon:"sap-icon://add-document",press:this.onOpenFreitextDialog.bind(this)})}const i=(r&&r.serviceId?String(r.serviceId):"oci").replace(/[^\w\-:.]/g,"_");return new sap.m.StandardListItem(this.createId("ociCatalogItem-"+i),{title:"{ociCatalogs>katalogName}",type:"Active",press:this.onOpenExternalWebshop.bind(this)})},onOpenExternalWebshop:function(e){const t=e.getSource().getBindingContext("ociCatalogs");if(!t){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.noCatalogSelected"));return}const r=t.getObject();const i=r.serviceId||r.katalogName;this._openOciCatalogById(i)},_openOciCatalogByCandidates:function(e){const t=(e||[]).map(e=>e===undefined||e===null?"":String(e).trim()).filter(Boolean).filter((e,t,r)=>r.indexOf(e)===t);if(t.length===0){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.noCatalogIdFound"));return}const r=e=>{if(e>=t.length){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.noActionInCustomizing"));return}this._openOciCatalogById(t[e],function(){r(e+1)})};r(0)},_openOciCatalogById:function(e){console.log("OPEN OCI CATALOG BY ID:",e);if(!e){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.noCatalogIdFound"));return}const t=this.getOwnerComponent().getModel();t.read("/OCIKatalogParamsSet",{filters:[new sap.ui.model.Filter("KatalogID",sap.ui.model.FilterOperator.EQ,String(e).trim())],success:function(t){const r=t&&t.results?t.results:[];if(r.length===0){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.noCustomizingForCatalog",[String(e).trim()]));return}const i=r.find(e=>!e.Fieldnam||String(e.Fieldnam).trim()==="");const s=i&&i.Fieldval;if(!s){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.noActionForCatalog",[String(e).trim()]));return}const n=r.filter(e=>e.Fieldnam&&String(e.Fieldnam).trim().length>0).map(e=>({name:String(e.Fieldnam),value:e.Fieldval===undefined||e.Fieldval===null?"":String(e.Fieldval)}));const o=sap.ui.require.toUrl("diehlwebshop/webshop/ExternerWebshop.html");let a=sessionStorage.getItem("OCI_TAB_ID");if(!a){a=String(Date.now())+"_"+Math.random().toString(16).slice(2);sessionStorage.setItem("OCI_TAB_ID",a)}let u="OCI_CATALOG_WIN_"+a;if(window.name===u){u=u+"_POP"}const l=(e,t)=>{const r=n.findIndex(t=>String(t.name).toUpperCase()===String(e).toUpperCase());if(r>-1){n[r].value=t}else{n.push({name:e,value:t})}};l("~TARGET",u);l("returntarget",window.name);const c=n.find(e=>String(e.name||"").trim().toUpperCase()==="LIFNR");const p=c?String(c.value||"").trim():"";try{const t={catalogId:String(e).trim(),lifnr:p,winName:u,ts:Date.now()};sessionStorage.setItem("OCI_LAST_CTX",JSON.stringify(t));sessionStorage.setItem("OCI_CTX_"+u,JSON.stringify(t))}catch(e){}const g=(e,t)=>{const r=String(e||"").toUpperCase();const i=["KENNWORT","PASSWORD","PASSWD","PWD","SECRET"].some(e=>r.includes(e));return i?"********":t};console.group("OCI DEBUG: Absprung vorbereiten");console.log("KatalogID:",e);console.log("action:",s);console.log("method:","POST");console.log("target window:",u);console.log("gemerkte Lifnr:",p||"(leer)");console.table(n.map(e=>({name:e.name,value:g(e.name,e.value)})));console.groupEnd();const d=window.open(o,u);if(!d){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.popupBlocked"));return}const h=window.location.origin;const m=e=>{if(e.source===d&&e.origin===h&&e.data&&e.data.type==="OCI_READY"){window.removeEventListener("message",m);d.postMessage({type:"OCI_POST",payload:{action:s,method:"POST",fields:n}},h)}};window.addEventListener("message",m);setTimeout(function(){try{if(!d.closed){d.postMessage({type:"OCI_PING"},h)}}catch(e){}},1e3)}.bind(this),error:function(e){sap.m.MessageToast.show(this.getResourceBundle().getText("oci.msg.readParamsFailed"));console.log(e)}})},_attachNumericGuard:function(e){if(!e){return}e.addEventDelegate({onkeydown:function(t){const r=t.originalEvent||t;const i=r.key;const s=r.ctrlKey||r.metaKey;const n=["Backspace","Tab","Delete","ArrowLeft","ArrowRight","Home","End","Enter","Escape"].includes(i)||s&&["a","c","v","x","A","C","V","X"].includes(i)||(/^[0-9]$/.test(i)||i===","||i===".");if(!n){if(!this._numWarnTs||Date.now()-this._numWarnTs>1200){sap.m.MessageToast.show(this.getResourceBundle().getText("home.input.numericOnlyToast"));this._numWarnTs=Date.now()}e.setValueState("Error");e.setValueStateText(this.getResourceBundle().getText("home.input.numericOnlyState"));setTimeout(()=>e.setValueState("None"),1e3);r.preventDefault()}}.bind(this)})},onOpenFreitextDialog:function(){if(!this._oFreitextDialog){this._oFreitextDialog=sap.ui.xmlfragment(this.getView().getId(),"diehlwebshop.view.FreitextDialog",this);this.getView().addDependent(this._oFreitextDialog)}this._oFreitextDialog.open();this._attachNumericGuard(this.byId("freitextInputQuantity"));this._attachNumericGuard(this.byId("freitextInputPrice"))},onCloseFreitextDialog:function(){if(this._oFreitextDialog){this._oFreitextDialog.close()}},onValueHelpSupplier:function(e){var t=this.getView();var r=this.getOwnerComponent().getModel();var i=e.getSource();this._oSuppActiveInput=i;if(!this._oSuppJsonModel){this._oSuppJsonModel=new sap.ui.model.json.JSONModel({results:[]});t.setModel(this._oSuppJsonModel,"vhSupp")}var s=function(){if(!this._oSuppVH){this._oSuppVH=new sap.m.SelectDialog({title:"Wunschlieferant wählen",items:{path:"vhSupp>/results",template:new sap.m.StandardListItem({title:"{vhSupp>Sortl}",description:"{vhSupp>Lifnr}"})},search:function(e){var t=(e.getParameter("value")||"").trim().toLowerCase();var r=e.getSource().getBinding("items");if(!r){return}if(!t){r.filter([]);return}r.filter([new sap.ui.model.Filter({filters:[new sap.ui.model.Filter({path:"Lifnr",operator:sap.ui.model.FilterOperator.Contains,value1:t}),new sap.ui.model.Filter({path:"Sortl",operator:sap.ui.model.FilterOperator.Contains,value1:t}),new sap.ui.model.Filter({path:"Mcod1",operator:sap.ui.model.FilterOperator.Contains,value1:t})],and:false})],"Application")}.bind(this),confirm:function(e){var t=e.getParameter("selectedItem");if(!t){return}var r=t.getBindingContext("vhSupp").getObject();var i=String(r.Lifnr||"").trim();if(this._oSuppActiveInput){this._oSuppActiveInput.setValue(i)}}.bind(this),cancel:function(){}});t.addDependent(this._oSuppVH);var e=this._oSuppVH.getSubHeader&&this._oSuppVH.getSubHeader()}var r=(i.getValue()||"").trim();this._oSuppVH.open(r);this._applySupplierSearchFilter(r)}.bind(this);var n=this._oSuppJsonModel.getProperty("/results")||[];if(n.length>0){s();return}r.read("/KredaSet",{urlParameters:{$select:"Lifnr,Sortl,Mcod1",$top:"5000"},success:function(e){var t=e&&e.results?e.results:[];t=t.map(function(e){var t=Object.assign({},e);t.__lifnr=String(t.Lifnr||"").toLowerCase();t.__sortl=String(t.Sortl||"").toLowerCase();t.__mcod1=String(t.Mcod1||"").toLowerCase();return t});this._oSuppJsonModel.setProperty("/results",t);s()}.bind(this),error:function(e){sap.m.MessageToast.show("Lieferanten konnten nicht geladen werden.");console.log(e)}})},_applySupplierSearchFilter:function(e){if(!this._oSuppVH){return}var t=String(e||"").trim().toLowerCase();var r=this._oSuppVH.getBinding("items");if(!r){return}if(!t){r.filter([]);return}r.filter([new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("__lifnr",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("__sortl",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("__mcod1",sap.ui.model.FilterOperator.Contains,t)],and:false})],"Application")},_resetFreitextInputs:function(){const e=["freitextInputDescription","freitextInputAddText","freitextInputRequester","freitextInputSupplier","freitextInputEkgrp","freitextInputExtMatnr","freitextInputQuantity","freitextInputPrice"];e.forEach(e=>{const t=this.byId(e);if(t&&t.setValue){t.setValue("")}if(t&&t.setValueState){t.setValueState("None")}if(t&&t.setValueStateText){t.setValueStateText("")}});const t=this.byId("freitextInputUnit");if(t&&t.setValue){t.setValue("ST")}const r=this.byId("freitextInputCurrency");if(r&&r.setValue){r.setValue("EUR")}},onRefresh:function(){var e=this.byId("productHomeList");var t=e.getBinding("items");var r=function(){this.byId("pullToRefresh").hide();t.detachDataReceived(r)}.bind(this);t.attachDataReceived(r);this._search()},_search:function(){const e=this.getView();const t=e.byId("productHomeList");const r=e.byId("categoryHomeList");const i=e.byId("searchField");const s=(i.getValue()||"").trim().toLowerCase();const n=s.length>0;t.setVisible(n);r.setVisible(!n);if(!n){return}const o=t.getItems();if(!Array.isArray(o)||o.length===0){return}o.forEach(function(e){const t=e.getBindingContext();const r=t&&t.getObject?t.getObject():null;if(!r){e.setVisible(false);return}const i=(r.ZmmWebsKatBez||r.ZmmWebsArtBez||"").toLowerCase();const n=(r.Wlief||"").toLowerCase();const o=(r.ZmmWebsArtikelId||"").toLowerCase();const a=(r.Matkl||"").toLowerCase();const u=[i,n,o,a].some(e=>e.includes(s));e.setVisible(u)})},onCategoryListItemPress:function(e){const t=e.getSource();const r=t.getBindingContext();const i=r&&r.getObject?r.getObject():null;const n=i&&String(i.ZmmWebsKatId||"").trim();const o=i&&String(i.ZmmWebsKatBez||"").trim();if(!n){sap.m.MessageToast.show(this.getResourceBundle().getText("home.msg.noCategoryId"));return}const a=this.byId("categoryHomeList");const u=this.getView().getModel("catnav");const l=(u.getProperty("/pathStack")||[]).slice();const c=l.length?String(l[l.length-1].text||"").trim().toLowerCase():"";const p=i&&String(i.WsiDescriptionText||"").trim();if(p){this._openOciCatalogById(p);return}const g=l.slice();g.push({id:n,text:o});u.setProperty("/pathStack",g);u.setProperty("/currentParentId",n);u.setProperty("/breadcrumbText",g.map(e=>e.text).join(" / "));this._refreshCategoryList();a.attachEventOnce("updateFinished",function(){if(a.getItems().length===0){this._router.navTo("category",{id:n},!s.system.phone)}},this)},onCategoryLevelUp:function(){const e=this.getView().getModel("catnav");const t=(e.getProperty("/pathStack")||[]).slice();t.pop();const r=t.length?t[t.length-1].id:"";e.setProperty("/pathStack",t);e.setProperty("/currentParentId",r);e.setProperty("/breadcrumbText",t.map(e=>e.text).join(" / "));this._refreshCategoryList()},onProductListSelect:function(e){var t=e.getParameter("listItem");this._showProduct(t)},onProductListItemPress:function(e){console.log("✅ onProductListItemPress wurde aufgerufen");var t=e.getSource();this._showProduct(t)},_showProduct:function(e){const t=e.getBindingContext().getObject();this._router.navTo("product",{id:String(t.ZmmWebsKatId),productId:String(t.ZmmWebsArtikelId)},!s.system.phone)},onBack:function(){this.getRouter().navTo("home")}})});
//# sourceMappingURL=Home.controller.js.map