sap.ui.define(["sap/ui/model/json/JSONModel"],t=>{"use strict";const e="webshop-db";const s="webshop";const o=150;function r(){return new Promise((t,o)=>{const r=indexedDB.open(e,1);r.onupgradeneeded=()=>r.result.createObjectStore(s);r.onsuccess=()=>t(r.result);r.onerror=()=>o(r.error)})}function n(t){return r().then(e=>new Promise((o,r)=>{const n=e.transaction(s,"readonly");const i=n.objectStore(s).get(t);i.onsuccess=()=>o(i.result);i.onerror=()=>r(i.error)}))}function i(t,e){return r().then(o=>new Promise((r,n)=>{const i=o.transaction(s,"readwrite");i.objectStore(s).put(e,t);i.oncomplete=()=>r();i.onerror=()=>n(i.error)}))}return t.extend("diehlwebshop.model.IndexedDBModel",{_STORAGE_KEY:"LOCALSTORAGE_MODEL",constructor:function(e,s){t.apply(this,[].slice.call(arguments,1));this.setSizeLimit(1e6);if(e){this._STORAGE_KEY=e}this._useIdb=typeof indexedDB!=="undefined";this._saveTimer=null;this._loadData();return this},async _loadData(){try{if(this._useIdb){const t=await n(this._STORAGE_KEY);if(t){this.setData(t)}}else{const t=window.localStorage.getItem(this._STORAGE_KEY);if(t){this.setData(JSON.parse(t))}}}catch(t){jQuery.sap.log.warning("Konnte Daten nicht laden",t)}this._bDataLoaded=true},_storeDataNow:async function(){try{const t=this.getData();if(this._useIdb){await i(this._STORAGE_KEY,t)}else{window.localStorage.setItem(this._STORAGE_KEY,JSON.stringify(t))}}catch(t){jQuery.sap.log.error("Konnte Daten nicht speichern",t)}},_storeData:function(){clearTimeout(this._saveTimer);this._saveTimer=setTimeout(()=>this._storeDataNow(),o)},setProperty:function(){t.prototype.setProperty.apply(this,arguments);this._storeData()},setData:function(){t.prototype.setData.apply(this,arguments);if(this._bDataLoaded){this._storeData()}},refresh:function(){t.prototype.refresh.apply(this,arguments);this._storeData()}})});
//# sourceMappingURL=IndexedDBModel.js.map